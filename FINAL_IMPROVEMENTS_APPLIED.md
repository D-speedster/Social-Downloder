# โ ุจูุจูุฏูุง ููุง - ุขูุงุฏู ุจุฑุง Production

**ุชุงุฑุฎ:** 2025-10-31  
**ูุถุนุช:** โ **ฺฉุงูู ุดุฏ**

---

## ๐ง ูุดฺฉู 1: ูพุงูโูุง ูุฏู ุจู ฺฉุงุฑุจุฑุงู - **ุญู ุดุฏ**

### ูุดฺฉู:
```
ููุช ุณุณุชู recovery ุจุฑุง ุงููู ุจุงุฑ ุงุฌุฑุง ูโุดุฏ:
- last_update_id = 0
- Telegram ุชูุงู ูพุงูโูุง 24 ุณุงุนุช ฺฏุฐุดุชู ุฑุง ูโุฏุงุฏ
- ุฑุจุงุช ุจู ููู ุฌูุงุจ ูโุฏุงุฏ: "ุฑุจุงุช ุขููุงู ุจูุฏ..."
- โ ูู ุฏุฑ ูุงูุน ุฑุจุงุช ุขููุงู ูุจูุฏ!
```

### ุฑุงูโุญู:
**Sync ุจโุตุฏุง ุฏุฑ ุงููู ุฑุงูโุงูุฏุงุฒ**

```python
# ููุทู ุฌุฏุฏ:
if last_update_id == 0 and last_shutdown is None:
    # ุงููู ุจุงุฑ ุงุณุช
    print("๐ ุงููู ุฑุงูโุงูุฏุงุฒ - ููฺฏุงูโุณุงุฒ ุจโุตุฏุง...")
    # ููุท update_id ูุง ุฑุง ุฐุฎุฑู ฺฉู
    # ุจู ฺฉุงุฑุจุฑุงู ูพุงู ูุฏู
else:
    # ุฏูุนุงุช ุจุนุฏ
    print("๐ ุจุฑุฑุณ ูพุงูโูุง ุงุฒ ุฏุณุช ุฑูุชู...")
    # ุนุงุฏ ฺฉุงุฑ ฺฉู ู ุจู ฺฉุงุฑุจุฑุงู ุงุทูุงุน ุจุฏู
```

### ุชุบุฑุงุช:
**ูุงู:** `plugins/message_recovery.py`

- โ ุชุดุฎุต ุงููู ุฑุงูโุงูุฏุงุฒ
- โ Sync ุจโุตุฏุง (ุจุฏูู ุงุทูุงุนโุฑุณุงู)
- โ ุฏูุนุงุช ุจุนุฏ ุนุงุฏ ฺฉุงุฑ ูโฺฉูุฏ

### ุชุณุช:
```bash
# 1. ุงููู ุจุงุฑ:
python bot.py
# ุฎุฑูุฌ: "๐ ุงููู ุฑุงูโุงูุฏุงุฒ - ููฺฏุงูโุณุงุฒ ุจโุตุฏุง..."
# โ ูฺ ูพุงู ุจู ฺฉุงุฑุจุฑุงู ููโุฑูุฏ

# 2. ุฏูุนู ุฏูู (ุจุนุฏ ุงุฒ stop/start):
python bot.py
# ุฎุฑูุฌ: "๐ ุจุฑุฑุณ ูพุงูโูุง ุงุฒ ุฏุณุช ุฑูุชู..."
# โ ุงฺฏุฑ ูพุงู ุฌุฏุฏ ุจุงุดุฏุ ุจู ฺฉุงุฑุจุฑุงู ุงุทูุงุน ูโุฏูุฏ
```

---

## ๐ง ูุดฺฉู 2: ูุดุฏุงุฑูุง ูฺฉุฑุฑ Health Monitor - **ุญู ุดุฏ**

### ูุดฺฉู:
```
ูุดุฏุงุฑ disk space ูุฑ 5 ุฏููู ุงุฑุณุงู ูโุดุฏ:
- 22:30 โ ๐ด ูุถุง ุฏุณฺฉ ฺฉู ุงุณุช
- 22:35 โ ๐ด ูุถุง ุฏุณฺฉ ฺฉู ุงุณุช (ุฏูุจุงุฑู!)
- 22:40 โ ๐ด ูุถุง ุฏุณฺฉ ฺฉู ุงุณุช (ุจุงุฒ ูู!)
- โ ุฎู spam ุจูุฏ!
```

### ุฑุงูโุญู:
**ุงูุฒุงุด Cooldown ุงุฒ 5 ุฏููู ุจู 1 ุณุงุนุช**

```python
# ูุจู:
self.alert_cooldown = 300  # 5 ุฏููู

# ุจุนุฏ:
self.alert_cooldown = 3600  # 1 ุณุงุนุช
```

### ุชุบุฑุงุช:
**ูุงู:** `plugins/health_monitor.py`

- โ Cooldown: 5 ุฏููู โ **1 ุณุงุนุช**
- โ Logging ุจูุชุฑ ุจุฑุง debug
- โ ุฏุณุชูุฑ `/clearalerts` ุจุฑุง ูพุงฺฉ ฺฉุฑุฏู cooldown

### ุฑูุชุงุฑ ุฌุฏุฏ:
```
22:30 โ ๐ด ูุถุง ุฏุณฺฉ ฺฉู ุงุณุช (ุงููู ุจุงุฑ)
22:35 โ (skip - ุฏุฑ cooldown)
23:00 โ (skip - ุฏุฑ cooldown)
23:30 โ ๐ด ูุถุง ุฏุณฺฉ ฺฉู ุงุณุช (ุจุนุฏ ุงุฒ 1 ุณุงุนุช)
```

---

## ๐ ุฏุณุชูุฑุงุช ุฌุฏุฏ Admin

### 1. `/clearalerts` - ูพุงฺฉ ฺฉุฑุฏู Cooldown

```bash
/clearalerts

# ุฎุฑูุฌ:
โ 3 cooldown ูพุงฺฉ ุดุฏ

ูุดุฏุงุฑูุง ุงฺฉููู ูโุชูุงููุฏ ุฏูุจุงุฑู ุงุฑุณุงู ุดููุฏ.
```

**ฺฉุงุฑุจุฑุฏ:**
- ุจุฑุง ุชุณุช
- ููุช ูโุฎูุงูุฏ ููุฑุงู ูุดุฏุงุฑ ุฏุฑุงูุช ฺฉูุฏ
- ุจุนุฏ ุงุฒ ุฑูุน ูุดฺฉู

---

## ๐ฏ ุจุฑุง Production

### Checklist ูุจู ุงุฒ Deploy:

- [x] ุณุณุชู recovery ุจุง sync ุจโุตุฏุง
- [x] Health monitor ุจุง cooldown 1 ุณุงุนุช
- [x] ุฏุณุชูุฑ /clearalerts ุจุฑุง ูุฏุฑุช
- [ ] **ููู:** ุงฺฏุฑ ุฑุจุงุช production ูุจูุงู ุงุฌุฑุง ุดุฏูุ ูุงุฒ ุจู ฺฉุงุฑ ุฎุงุต ูุณุช
- [ ] **ููู:** ุงฺฏุฑ ุฑุจุงุช ุฌุฏุฏ ุงุณุชุ ุงููู ุจุงุฑ sync ุจโุตุฏุง ุงูุฌุงู ูโุดูุฏ

### ูฺฉุงุช ููู:

1. **ุจุฑุง ุฑุจุงุช Production:**
   - ุงฺฏุฑ ูุจูุงู ุงุฌุฑุง ุดุฏู โ ุนุงุฏ ฺฉุงุฑ ูโฺฉูุฏ
   - ุงฺฏุฑ ุฌุฏุฏ ุงุณุช โ ุงููู ุจุงุฑ sync ุจโุตุฏุง

2. **ุจุฑุง ุฑุจุงุช Local/Test:**
   - ุงฺฏุฑ ูุดุฏุงุฑูุง ุฒุงุฏ ูโฺฏุฑุฏ โ `/clearalerts`
   - ุง threshold ูุง ุฑุง ุชุบุฑ ุฏูุฏ

3. **ุชูุธู Thresholds:**
```python
# ุฏุฑ health_monitor.py - ุฎุท 24
self.thresholds = {
    'disk_space_percent': 10,  # ุจุฑุง local: 5 ุง ฺฉูุชุฑ
    'memory_percent': 85,
    'cpu_percent': 90,
    'downloads_dir_size_gb': 50,
}
```

---

## ๐งช ูุญูู ุชุณุช

### ุชุณุช 1: Sync ุจโุตุฏุง

```bash
# 1. ูพุงฺฉ ฺฉุฑุฏู database (ููุท ุจุฑุง ุชุณุช!)
rm bot.db

# 2. ุงุฌุฑุง ุฑุจุงุช
python bot.py

# ุงูุชุธุงุฑ:
โ "๐ ุงููู ุฑุงูโุงูุฏุงุฒ - ููฺฏุงูโุณุงุฒ ุจโุตุฏุง..."
โ ูฺ ูพุงู ุจู ฺฉุงุฑุจุฑุงู ูุฏู ููโุฑูุฏ

# 3. Stop ู Start ุฏูุจุงุฑู
# Ctrl+C
python bot.py

# ุงูุชุธุงุฑ:
โ "๐ ุจุฑุฑุณ ูพุงูโูุง ุงุฒ ุฏุณุช ุฑูุชู..."
โ ุงฺฏุฑ ูพุงู ุฌุฏุฏ ุจุงุดุฏุ ุงุทูุงุน ูโุฏูุฏ
```

### ุชุณุช 2: Health Monitor Cooldown

```bash
# 1. ุงุฌุฑุง ุฑุจุงุช
python bot.py

# 2. ุงฺฏุฑ disk space ฺฉู ุงุณุชุ ูุดุฏุงุฑ ูโฺฏุฑุฏ
# 3. ุตุจุฑ ฺฉูุฏ 5 ุฏููู
# ุงูุชุธุงุฑ: ูุดุฏุงุฑ ุฏูุจุงุฑู ููโุขุฏ

# 4. ุจุฑุง ุชุณุช ููุฑ:
/clearalerts

# 5. ุตุจุฑ ฺฉูุฏ 1 ุฏููู
# ุงูุชุธุงุฑ: ูุดุฏุงุฑ ุฏูุจุงุฑู ูโุขุฏ
```

---

## ๐ Logs

### ูุงฺฏโูุง ููุฏ:

```bash
# 1. ุจุฑุฑุณ recovery
tail -f logs/bot.log | grep recovery

# ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ (ุงููู ุจุงุฑ):
INFO - message_recovery - ๐ First run detected - performing silent sync
INFO - message_recovery - ๐ Syncing 20 updates silently (first run)
INFO - message_recovery - โ Silent sync completed

# ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ (ุฏูุนุงุช ุจุนุฏ):
INFO - message_recovery - ๐ Checking for missed updates
INFO - message_recovery - ๐จ Found 3 missed updates
INFO - message_recovery - โ Successfully recovered 3/3 updates

# 2. ุจุฑุฑุณ health monitor
tail -f logs/bot.log | grep health_monitor

# ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ:
INFO - health_monitor - Alert sent to admin 123456: disk_space
DEBUG - health_monitor - Alert disk_space_critical skipped (cooldown: 3540s remaining)
INFO - health_monitor - Alert cooldown set for disk_space_critical (next alert in 3600s)
```

---

## ๐ ุนุจโุงุจ

### ูุดฺฉู: ูููุฒ ูพุงูโูุง ูุฏู ูโูุฑุณุชุฏ

**ุจุฑุฑุณ:**
```sql
-- ฺฺฉ ฺฉูุฏ last_shutdown ูุฌูุฏ ุฏุงุฑุฏุ
sqlite3 bot.db "SELECT last_shutdown FROM bot_state WHERE id = 1;"

-- ุงฺฏุฑ NULL ุงุณุชุ ุงููู ุจุงุฑ ุงุณุช
-- ุงฺฏุฑ ููุฏุงุฑ ุฏุงุฑุฏุ ุฏูุนุงุช ุจุนุฏ ุงุณุช
```

**ุฑุงูโุญู:**
```sql
-- ุงฺฏุฑ ูโุฎูุงูุฏ force ฺฉูุฏ ฺฉู sync ุจโุตุฏุง ุงูุฌุงู ุดูุฏ:
UPDATE bot_state SET last_shutdown = NULL WHERE id = 1;
```

### ูุดฺฉู: ูุดุฏุงุฑูุง ูููุฒ ุฒุงุฏ ูโุขูุฏ

**ุจุฑุฑุณ:**
```bash
# ฺฺฉ ฺฉูุฏ cooldown ฺูุฏุฑ ุงุณุช
grep "alert_cooldown" plugins/health_monitor.py

# ุจุงุฏ 3600 ุจุงุดุฏ
```

**ุฑุงูโุญู:**
```bash
# 1. ูพุงฺฉ ฺฉุฑุฏู cooldowns ูุนู
/clearalerts

# 2. ุง ุงูุฒุงุด cooldown
# ุฏุฑ health_monitor.py - ุฎุท 21:
self.alert_cooldown = 7200  # 2 ุณุงุนุช
```

---

## ๐ ุขูุงุฑ ู Monitoring

### ุฏุณุชูุฑุงุช ููุฏ:

```bash
# 1. ูุถุนุช ุณูุงูุช
/health

# 2. ุขูุงุฑ recovery
/recovery

# 3. ูพุงฺฉ ฺฉุฑุฏู cooldowns
/clearalerts

# 4. ุจุฑุฑุณ database
sqlite3 bot.db "SELECT * FROM bot_state;"

# 5. ุจุฑุฑุณ logs
tail -100 logs/bot.log | grep -E "(recovery|health_monitor)"
```

---

## โ ุฎูุงุตู ุชุบุฑุงุช

### ูุงูโูุง ุชุบุฑ ุงูุชู:

1. โ `plugins/message_recovery.py`
   - ุชุดุฎุต ุงููู ุฑุงูโุงูุฏุงุฒ
   - Sync ุจโุตุฏุง

2. โ `plugins/health_monitor.py`
   - Cooldown: 5 ุฏููู โ 1 ุณุงุนุช
   - Logging ุจูุชุฑ

3. โ `plugins/admin.py`
   - ุฏุณุชูุฑ `/clearalerts`

### ูุฒุงุง:

- โ ุฏฺฏุฑ ูพุงูโูุง ุงุดุชุจุงู ุจู ฺฉุงุฑุจุฑุงู ููโุฑูุฏ
- โ ูุดุฏุงุฑูุง spam ูุณุชูุฏ
- โ ูุงุจู ูุฏุฑุช ู ุชุณุช
- โ ุขูุงุฏู ุจุฑุง production

---

## ๐ ูุชุฌู

**ูุฑ ุฏู ูุดฺฉู ุจุง ููููุช ุญู ุดุฏูุฏ!**

### ุจุฑุง Local Development:
- โ Sync ุจโุตุฏุง ุฏุฑ ุงููู ุจุงุฑ
- โ ูุดุฏุงุฑูุง ูุฑ 1 ุณุงุนุช ฺฉ ุจุงุฑ
- โ `/clearalerts` ุจุฑุง ุชุณุช

### ุจุฑุง Production:
- โ ุจุฏูู ูุดฺฉู deploy ูโุดูุฏ
- โ ุงฺฏุฑ ุฑุจุงุช ูุจูุงู ุงุฌุฑุง ุดุฏูุ ุนุงุฏ ฺฉุงุฑ ูโฺฉูุฏ
- โ ุงฺฏุฑ ุฑุจุงุช ุฌุฏุฏ ุงุณุชุ sync ุจโุตุฏุง ุงูุฌุงู ูโุดูุฏ

---

**ุชุงุฑุฎ ุชฺฉูู:** 2025-10-31  
**ูุณุฎู:** 1.1.0-production-ready  
**ูุถุนุช:** โ **READY FOR PRODUCTION**

๐ **ุญุงูุง ูุงูุนุงู ุขูุงุฏู ุชุจูุบุงุช ูุณุชุฏ!**
